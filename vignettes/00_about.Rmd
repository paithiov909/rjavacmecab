---
title: "About rjavacmecab package"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
header-includes:
  - \usepackage[utf8]{inputenc}
vignette: >
  %\VignetteIndexEntry{About rjavacmecab package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  tidy = "styler",
  collapse = TRUE,
  comment = "#>"
)
stopifnot(
  require(rjavacmecab)
)
```

## これは何？

{rjavacmecab}は、[takscape/cmecab-java: A Java binding for MeCab](https://github.com/takscape/cmecab-java)をrJava経由で呼び出してMeCabを利用するためのパッケージです。

## インストール

`remotes::install_github("paithiov909/rjavacmecab")`

## 環境の準備

あらかじめMeCabとJDKが利用できるようになっている必要があります。

### MeCabの準備

MeCabの辞書はUTF-8を指定してインストールされていることを前提にしています。Windowsで64bit用のJDKを利用する場合、MeCabも64bit向けのものを用意する必要があります。Windows 64bitの場合、以下などを利用してください。

- [Release MeCab 0.996 64bit version · ikegami-yukino/mecab](https://github.com/ikegami-yukino/mecab/releases/tag/v0.996.2)

{rjavacmecab}はcmecab-javaのrJavaラッパーライブラリです。cmecab-javaを利用するためにはMeCabのダイナミックライブラリにパスが通っている必要があります。

Windowsの場合、インストールしたMeCabのディレクトリ以下の`bin`ディレクトリにパスを通します。LinuxやMacの場合、LD_LIBRARY_PATHに`libmecab.so`（Linuxの場合）や`libmecab.dylib`（Macの場合）のあるディレクトリを追加します。

Ubuntuなどでaptを通じてMeCabを導入した場合、`libmecab.so`は`/usr/local/lib`以下にあるので、このディレクトリをLD_LIBRARY_PATHに追加します。

``` bash
$ sudo apt install mecab
$ sudo apt install libmecab-dev
$ sudo apt install mecab-ipadic-utf8
$ export LD_LIBRARY_PATH="/usr/local/lib:$LD_LIBRARY_PATH"
```

MacでHomebrewからMeCabを導入した場合だと、`libmecab.dylib`は`/usr/local/Cellar/mecab/0.996/lib`以下にあるので、このディレクトリをLD_LIBRARY_PATHに追加します。

``` bash
$ brew install mecab
$ brew install mecab-ipadic
$ export LD_LIBRARY_PATH="/usr/local/Cellar/mecab/0.996/lib:$LD_LIBRARY_PATH"
```

### rJava周りで問題が発生する場合

環境によってはrJavaパッケージはソースからビルドされている必要があります。{rJava}をソースからビルドするには、多くの場合はJavaを適切にインストールしたあとに`R CMD javareconf`を実行したうえで、R上で`install.packages("rJava", type="source")`などとすれば解決します。

rJavaの周辺は比較的問題が起こりやすく、たとえばパッケージの読みこみ時に`jvm`のロードに失敗したりするといったことがあります（古いバージョンのRstudioを使用している場合などに発生することが報告されています）。こうした場合は`dyn.load()`関数に使用したいJREに付属しているダイナミックライブラリを明示的に渡すか、rJavaが読みにいっているファイルにシンボリックリンクを上書きするなどして対処します。

また、パッケージのビルド時に`clang: error: unsupported option '-fopenmp`が発生してビルドに失敗する場合、Rパッケージのビルドに使用されるコンパイラの設定をしなおす必要があります。詳しくは以下に挙げる記事などを参考にしてください。

- [Installing rJava on macOS | Zhiya Zuo](https://zhiyzuo.github.io/installation-rJava/)
- [java - R, loading rJava error - Stack Overflow](https://stackoverflow.com/questions/44157869/r-loading-rjava-error)
- [installation - rJava on MacOS Sierra 10.12.15: unsupported option fopenmp - Stack Overflow](https://stackoverflow.com/questions/44383668/rjava-on-macos-sierra-10-12-15-unsupported-option-fopenmp)
- [java - rJava loading in R(3.4.1) with OS Sierra - Stack Overflow](https://stackoverflow.com/questions/45051275/rjava-loading-in-r3-4-1-with-os-sierra)

## 使用例

### cmecab-javaの呼び出し

```{r cmecab1}
res <- rjavacmecab::cmecab("キャピキャピ音が高くなってきたら、ほんとに出してくれの合図です！　しっかりここではコミュニケーションとってください")
print(res)
```

```{r cmecab2}
head(rjavacmecab::prettify(res)) # dataframeに整形します
```

整形されたデータフレームは次のカラムからなります。IPA辞書とは異なる品詞体系の辞書を使っている場合は、素性情報を`into`引数に渡してください。

- Surface: 表層形
- POS1~POS4: 品詞, 品詞細分類1, 品詞細分類2, 品詞細分類3,
- X5StageUse1: 活用型（ex. 五段, 下二段...）
- X5StageUse2: 活用形（ex. 連用形, 終止形...）
- Original: 原形（lemmatised form）
- Yomi1: 読み（readings）
- Yomi2: 発音（pronunciation）

### 辞書の差し替え

確認できたかぎりでは`-d`オプションは動作します。

``` r
str <- "きゃりーぱみゅぱみゅ"
rjavacmecab::cmecab(str)
#> [[1]]
#> [1] "きゃ 動詞,非自立,*,*,五段・カ行促音便,仮定縮約１,く,キャ,キャ"
#> 
#> [[2]]
#> [1] "り 助動詞,*,*,*,文語・リ,基本形,り,リ,リ"
#> 
#> [[3]]
#> [1] "ー 名詞,固有名詞,一般,*,*,*,*"
#> 
#> [[4]]
#> [1] "ぱみゅぱみゅ 名詞,一般,*,*,*,*,*"
#> 
#> [[5]]
#> [1] "EOS"
rjavacmecab::cmecab(str, "-d /MeCab/dic/mecab-ipadic-neologd")
#> [[1]]
#> [1] "きゃりーぱみゅぱみゅ 名詞,固有名詞,人名,一般,*,*,きゃりーぱみゅぱみゅ,キャリーパミュパミュ,キャリーパミュパミュ"
#> 
#> [[2]]
#> [1] "EOS"
```

