---
title: "How to use on Colaboratory"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
header-includes:
  - \usepackage[utf8]{inputenc}
vignette: >
  %\VignetteIndexEntry{How to use on Colaboratory}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

##  ColabでMeCabを入れてRから（rJava経由で）呼ぶ

あらかじめ次のようなことをすればできる。

- rpy2のロード
- MeCab(+IPAdic)のインストール
- Java(JRE/JDK)のアップデート
- JAVA_HOMEの設定
- R CMD javareconf
- rJavaのインストール

## セットアップ

### rpy2のロード

Rのランタイムはデフォルトで入っているらしいので、rpy2経由でRを利用できる。マジックコマンドでロードする。

``` ipynb
%load_ext rpy2.ipython
```

### MeCabのインストール

aptで入るので、こう。

``` bash
%%bash
apt install mecab libmecab-dev mecab-ipadic-utf8
```

### Javaのアップデート

たぶんもとから入っているので必要ないかもしれない。

``` bash
%%bash
apt-get install default-jre
apt-get install default-jdk
java -version   # check java version
```

### JAVA_HOMEの設定

Pythonから設定してしまう。

``` py
import os
os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-11-openjdk-amd64"
```

### R CMD javareconf

``` bash
%%bash
R CMD javareconf
```

### rJavaのインストール

aptからも入るが、これだと動かないかもしれない（よく確かめていない）。

``` bash
%%bash
apt-get install r-cran-rjava
```

Rの`install.packages()`から入れる場合、libjvm.soを`dyn.load()`で明示的に指定して読み込まないとパッケージのインストールに失敗する。

``` r
%%R   # このマジックコマンドをコードブロックの先頭に付けるとそのブロックにRが書ける
dyn.load("/usr/lib/jvm/java-11-openjdk-amd64/lib/server/libjvm.so")
install.packages("rJava")
```

## rJavaに依存するパッケージのインストール

ここまで正しくやってrJavaがちゃんと入っているとふつうに入れることができる。

``` r
%%R
remotes::install_github("paithiov909/rjavacmecab")
rjavacmecab::cmecab("こんにちは")   # test use
#> [[1]]
#> [1] "こんにちは 感動詞,*,*,*,*,*,こんにちは,コンニチハ,コンニチワ"
#> 
#> [[2]]
#> [1] "EOS"
```

## おまけ

### RcppMeCabのインストール

rpy2をロード後にふつうに入れることができる。MeCabのインストールは必要。

``` r
%%R
Sys.setenv(MECAB_LANG = 'ja') # for installing Japanese developmental version
install.packages("RcppMeCab", type = "source") # build from source
RcppMeCab("こんにちは")   # test use
#> $こんにちは
#> [1] "こんにちは/感動詞"
```

### RMeCabのインストール

こちらもふつうに入る。

``` r
%%R
install.packages("RMeCab", repos = "https://rmecab.jp/R", type = "source") 
RMeCab::RMeCabC("こんにちは")
#> [[1]]
#>       感動詞 
#> "こんにちは" 
```

## 参考にした記事

- [Google ColaboratoryでRを使う | marketechlabo](https://www.marketechlabo.com/google-colaboratory-with-r/)

